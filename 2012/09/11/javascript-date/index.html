<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>JavaScript Date | 周亮的博客</title><meta name="description" content="JavaScript Date - Liang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="周亮的博客"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="周亮的博客" type="application/atom+xml">
</head><body><div class="wrap"><header><h1 class="branding"><a href="/" title="周亮的博客">周亮的博客</a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/zh-liang-cn/" target="_blank">GITHUB</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">JavaScript Date</h1><div class="post-info"><a></a>2012-09-11</div><div class="post-content"><p><strong>2013-07-03 更新：</strong></p>
<blockquote>
<p>为了解决本文中的关于Date的一些坑，我创建了一个项目<a target="_blank" rel="noopener" href="https://github.com/zhlwish/enhanced-jsdate">enhanced-jsdate</a>，非常简单，有<a target="_blank" rel="noopener" href="https://github.com/zhlwish/enhanced-jsdate/blob/master/src/enhanced-jsdate.coffee">CoffeeScript</a>和<a target="_blank" rel="noopener" href="https://github.com/zhlwish/enhanced-jsdate/blob/master/lib/enhanced-jsdate.js">JavaScript</a>两个版本。</p>
</blockquote>
<p>今天工作中遇到JavaScript的Date计算和格式化的问题，顺便整理了一下JavaScript中的Date的相关API，试做简单记录，代码均在<a target="_blank" rel="noopener" href="http://nodejs.org/">Node.js</a>上测试通过。</p>
<h2 id="Date构造函数"><a href="#Date构造函数" class="headerlink" title="Date构造函数"></a>Date构造函数</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当前时间</span></span><br><span class="line"><span class="comment">// Tue Sep 11 2012 15:37:46 GMT+0800 (中国标准时间)</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="comment">// Fri Jan 02 1970 08:00:00 GMT+0800 (中国标准时间)</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">3600</span> * <span class="number">24</span> * <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>除了构造函数外，<code>Date.UTC()</code>也用于构造日期，但是并不返回Date，而是返回从1970-01-01开始的毫秒数，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1328054400100, 即2012-01-01 00:00:00 0100</span></span><br><span class="line"><span class="built_in">Date</span>.UTC(<span class="number">2012</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<p>需要注意的是，<code>Date()</code> 函数返回日期字符串，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// date是字符串：&#x27;Tue Sep 11 2012 15:34:48 GMT+0800 (中国标准时间)&#x27;</span></span><br><span class="line"><span class="keyword">var</span> date = <span class="built_in">Date</span>();</span><br></pre></td></tr></table></figure>

<h2 id="字符串转日期"><a href="#字符串转日期" class="headerlink" title="字符串转日期"></a>字符串转日期</h2><p>Date.parse(string)方法并 _不是返回Date，而是返回整数_。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1120752000000, 即2005-07-08</span></span><br><span class="line"><span class="built_in">Date</span>.parse(<span class="string">&quot;Jul 8, 2005&quot;</span>);</span><br><span class="line"><span class="built_in">Date</span>.parse(<span class="string">&quot;2005-07-08&quot;</span>);</span><br><span class="line"><span class="built_in">Date</span>.parse(<span class="string">&quot;2005/07/08&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="日期转字符串"><a href="#日期转字符串" class="headerlink" title="日期转字符串"></a>日期转字符串</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">toString();         <span class="comment">// Tue Sep 11 2012 15:09:01 GMT+0800</span></span><br><span class="line">toTimeString();     <span class="comment">// 15:09:34 GMT+0800</span></span><br><span class="line">toDateString();     <span class="comment">// Tue Sep 11 2012</span></span><br><span class="line">toGMTString();      <span class="comment">// Tue, 11 Sep 2012 07:10:05 GMT</span></span><br><span class="line">toUTCString();      <span class="comment">// Tue, 11 Sep 2012 07:10:17 GMT</span></span><br><span class="line">toLocaleString();   <span class="comment">// 2012年9月11日 15:10:31</span></span><br><span class="line">toLocaleTimeString();   <span class="comment">// 15:10:45</span></span><br><span class="line">toLocaleDateString();   <span class="comment">// 2012年9月11日</span></span><br></pre></td></tr></table></figure>

<h2 id="Get系列方法"><a href="#Get系列方法" class="headerlink" title="Get系列方法"></a>Get系列方法</h2><p>Date提供了一系列Get和Set方法，可以获取和设置年份、月份、日期、小时等等信息，并且提供了本地时间和UTC时间两套方案。</p>
<p>获取本地时间方法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">date.getDate();     <span class="comment">// 从 Date 对象返回一个月中的某一天 (1 ~ 31)。</span></span><br><span class="line">date.getDay();      <span class="comment">// 从 Date 对象返回一周中的某一天 (0 ~ 6)。</span></span><br><span class="line">date.getMonth();    <span class="comment">// 从 Date 对象返回月份 (0 ~ 11)。</span></span><br><span class="line">date.getFullYear(); <span class="comment">// 从 Date 对象以四位数字返回年份。不用使用getYear()。</span></span><br><span class="line">date.getHours();    <span class="comment">// 返回 Date 对象的小时 (0 ~ 23)。</span></span><br><span class="line">date.getMinutes();  <span class="comment">// 返回 Date 对象的分钟 (0 ~ 59)。</span></span><br><span class="line">date.getSeconds();  <span class="comment">// 返回 Date 对象的秒数 (0 ~ 59)。</span></span><br><span class="line">date.getMilliseconds(); <span class="comment">//返回 Date 对象的毫秒(0 ~ 999)。</span></span><br></pre></td></tr></table></figure>

<p>另外，<code>date.getTime()</code>方法返回从1970-01-01开始到现在的毫秒数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date.getTime(); <span class="comment">// 返回1970年1月1日至今的毫秒数。</span></span><br></pre></td></tr></table></figure>

<p>Get系列获取本地时间的方法和获取UTC时间的方法一一对应，如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date.getUTCDate();</span><br></pre></td></tr></table></figure>

<h2 id="Set系列方法"><a href="#Set系列方法" class="headerlink" title="Set系列方法"></a>Set系列方法</h2><p>Set系列方法和Get系列方法一一对应，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date.setDate(<span class="number">24</span>);</span><br><span class="line">date.setUTCDate(<span class="number">24</span>);</span><br></pre></td></tr></table></figure>

<p>同样，<code>date.setTime(time)</code>方法以毫秒数设置Date对象，和<code>new Date(time)</code>的作用一样。</p>
<h2 id="Date之间的计算"><a href="#Date之间的计算" class="headerlink" title="Date之间的计算"></a>Date之间的计算</h2><p>Date之间的计算实际上是毫秒数的计算，加法除外，加法实际上是字符串连接，比如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tue Sep 11 2012 15:40:45 GMT+0800 (中国标准时间)</span></span><br><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="comment">// Tue Sep 11 2012 15:40:50 GMT+0800 (中国标准时间)</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="comment">// -5781</span></span><br><span class="line"><span class="built_in">console</span>.log(d - b);</span><br><span class="line"><span class="comment">// &#x27;Tue Sep 11 2012 15:40:45 GMT+0800 (中国标准时间)Tue Sep 11 2012 15:40:50 GMT+0800 (中国标准时间)&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(d + b);</span><br><span class="line"><span class="comment">// 0.999999995709353</span></span><br><span class="line"><span class="built_in">console</span>.log(d / b);</span><br><span class="line"><span class="comment">// 1.8153499959824195e+24</span></span><br><span class="line"><span class="built_in">console</span>.log(d * b);</span><br></pre></td></tr></table></figure>

<h2 id="Date到字符串的自定义格式转换"><a href="#Date到字符串的自定义格式转换" class="headerlink" title="Date到字符串的自定义格式转换"></a>Date到字符串的自定义格式转换</h2><p>JavaScript并没有提供像Ruby的<code>strftime()</code>这样的方法，如果需要某种格式的日期字符串只能自己实现。比如下面方法实现将日期转化成_yyyy-mm-dd_形式的字符串。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Date</span>.prototype.toHyphenDateString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> year = <span class="built_in">this</span>.getFullYear();</span><br><span class="line">    <span class="keyword">var</span> month = <span class="built_in">this</span>.getMonth() + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> date = <span class="built_in">this</span>.getDate();</span><br><span class="line">    <span class="keyword">if</span> (month &lt; <span class="number">10</span>) &#123; month = <span class="string">&quot;0&quot;</span> + month; &#125;</span><br><span class="line">    <span class="keyword">if</span> (date &lt; <span class="number">10</span>) &#123; date = <span class="string">&quot;0&quot;</span> + date; &#125;</span><br><span class="line">    <span class="keyword">return</span> year + <span class="string">&quot;-&quot;</span> + month + <span class="string">&quot;-&quot;</span> + date;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="comment">// 输出2012-09-11</span></span><br><span class="line"><span class="built_in">console</span>.log(date.toHyphenDateString());</span><br></pre></td></tr></table></figure>

<p>如果需要将日期转换为_3天之前_或者_4小时之前_这样的字符串，可以使用<a target="_blank" rel="noopener" href="http://timeago.yarp.com/">JQuery timeago插件</a>。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.w3school.com.cn/js/jsref_obj_date.asp">JavaScript Date 对象参考手册</a></li>
<li><a target="_blank" rel="noopener" href="http://timeago.yarp.com/">JQuery timeago插件</a></li>
<li><a target="_blank" rel="noopener" href="http://nodejs.org/">Node.js</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2012/09/27/vim-upcase-downcase/">prev</a><a class="next" href="/2012/08/01/rails-rack/">next</a></div><div class="copyright"><p>&copy; 2012 - 2021 <a href="https://zh-liang-cn.github.io">Liang</a>.<br>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/Dreyer/hexo-theme-artemis" target="_blank">Artemis</a>.</p></div></footer></div></body></html>